# Trade Signal Bot — Render-ready Deployment

This repository contains a Telegram signal‑forwarding bot designed to run 24/7 on [Render](https://render.com) using Telethon and Flask.

## Features

* Forward messages from one or more **source channels** to a single **destination channel**.
* Intelligent signal parsing with support for multiple formats. Noise messages (updates, screenshots, etc.) are ignored.
* Compact, unified output format that omits the original source.
* Web dashboard for configuring API credentials, source/destination channels and for starting/stopping the bot.
* Single‑process, single‑thread deployment to avoid `sqlite3.OperationalError: database is locked` errors.

## Repository Layout

```
app.py               # Flask application with dashboard and bot lifecycle controls
models.py            # SQLAlchemy models for configuration and optional signal storage
signal_bot.py        # Telethon wrapper with intelligent signal parsing
gunicorn.conf.py     # Gunicorn configuration (single worker/thread)
wsgi.py              # Entrypoint for Gunicorn
requirements.txt     # Python dependencies
templates/           # HTML templates for the web dashboard
README.md            # This file
```

## Running Locally

1. Install dependencies:

   ```bash
   pip install -r requirements.txt
   ```

2. Place your Telethon session file (e.g. `signal_bot.session`) in the project root. This file is generated by logging into your Telegram account once using Telethon.

3. Start the application:

   ```bash
   python app.py
   ```

4. Open http://127.0.0.1:5000 in your browser and fill in your API ID, API hash, session name, source channels and destination channel.  Click **Start Bot** to begin forwarding.

## Deploying to Render

1. Push this repository (minus your session file) to GitHub.
2. Create a new **Web Service** on Render and point it at your repository.
3. Use the following commands when prompted:

   * **Build command**: `pip install -r requirements.txt`
   * **Start command**: `gunicorn -c gunicorn.conf.py wsgi:app`

4. In the Render dashboard, create environment variables for your bot:

   * `API_ID` – your Telegram API ID.
   * `API_HASH` – your Telegram API hash.
   * `SOURCES` – a JSON array of source channel usernames or numeric IDs (e.g. `["@sourceA", -1001234567890]`).
   * `DESTS` – a JSON array of destination channel usernames or numeric IDs.  Only the first entry is currently used.
   * `SESSION_NAME` (optional) – the base name of your Telethon session file (default: `signal_bot`).  The file must be mounted in the working directory as `<SESSION_NAME>.session`.

5. Upload your `<SESSION_NAME>.session` file to the root of the repository or mount it via a persistent volume.

6. Deploy the service.  Once running, visit `/` to configure the bot if you have not set environment variables.  The dashboard allows you to start and stop the bot without redeploying.

## Notes

* The Gunicorn configuration sets **workers=1** and **threads=1** to ensure that both the Flask app and Telethon share a single SQLite connection.  This prevents `database is locked` errors.
* Channel identifiers prefixed with `@` are resolved automatically.  Numeric channel IDs (e.g. 1467736193) are coerced to the proper negative format (`-1001467736193`) for Telegram API compatibility.
* If a source channel has forwarding restrictions enabled, the bot will attempt to copy the content instead of forwarding.  This fallback works for both text messages and media messages.