<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Trade Signal Bot Dashboard</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 2rem auto;
            max-width: 600px;
            line-height: 1.6;
        }
        h1 { text-align: center; }
        form {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        label { display: block; margin-top: 0.5rem; font-weight: bold; }
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 0.5rem;
            margin-top: 0.25rem;
            box-sizing: border-box;
        }
        button {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            font-size: 1rem;
        }
        .status { margin-top: 2rem; font-weight: bold; text-align: center; }
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            color: white;
        }
        .badge-running { background-color: #28a745; }
        .badge-stopped { background-color: #dc3545; }
    </style>
</head>
<body>
    <h1>Trade Signal Bot</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul style="list-style:none; padding: 0;">
        {% for category, message in messages %}
          <li class="flash-{{ category }}">{{ message }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <form action="{{ url_for('on_save') }}" method="post">
        <h2>Configuration</h2>
        <label for="api_id">API ID</label>
        <input type="number" id="api_id" name="api_id" value="{{ cfg.api_id or '' }}">

        <label for="api_hash">API HASH</label>
        <input type="text" id="api_hash" name="api_hash" value="{{ cfg.api_hash or '' }}">

        <label for="session_name">Session Name</label>
        <input type="text" id="session_name" name="session_name" value="{{ cfg.session_name or '' }}">

        <label for="from_channels">Source Channels</label>
        <input type="text" id="from_channels" name="from_channels"
               placeholder='e.g. ["@src1", -10012345]' value="{{ cfg.from_channels or '' }}">
        <small>Enter JSON array (e.g. ["@src1", -10012345]) or comma-separated list (e.g. @src1, -10012345)</small>

        <label for="to_channel">Destination Channels</label>
        <input type="text" id="to_channel" name="to_channel"
               placeholder='e.g. ["@dest1", "@dest2"]' value="{{ cfg.to_channel or '' }}">
        <small>Enter JSON array or comma-separated list for multiple destinations</small>

        <button type="submit">Save</button>
    </form>

    <form action="{{ url_for('start_bot') }}" method="post" style="display:inline-block; margin-right:1rem;">
        <button type="submit">Start Bot</button>
    </form>
    <form action="{{ url_for('stop_bot') }}" method="post" style="display:inline-block;">
        <button type="submit">Stop Bot</button>
    </form>

    <div class="status" id="status">
        Status: <span class="badge" id="statusBadge">Loadingâ€¦</span>
    </div>

    <script>
    function updateStatus() {
        fetch("{{ url_for('status') }}")
            .then((resp) => resp.json())
            .then((data) => {
                const badge = document.getElementById('statusBadge');
                if (data.running) {
                    badge.textContent = 'Running';
                    badge.className = 'badge badge-running';
                } else {
                    badge.textContent = 'Stopped';
                    badge.className = 'badge badge-stopped';
                }
                setTimeout(updateStatus, 4000);
            })
            .catch(() => {
                const badge = document.getElementById('statusBadge');
                badge.textContent = 'Error';
                badge.className = 'badge badge-stopped';
                setTimeout(updateStatus, 4000);
            });
    }
    updateStatus();
    </script>
</body>
</html>
