{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>تنظیمات</h2>
  <form method="post" action="{{ url_for('save_config') }}">
    <div class="row">
      <div class="col-6">
        <label>API ID</label>
        <input name="api_id" value="{{ (cfg.api_id if cfg else '') or '' }}" required>
      </div>
      <div class="col-6">
        <label>API HASH</label>
        <input name="api_hash" value="{{ (cfg.api_hash if cfg else '') or '' }}" required>
      </div>
    </div>
    <div class="row">
      <div class="col-6">
        <label>Session String</label>
        <textarea name="session_string" placeholder="session string">{{ (cfg.session_string if cfg else '') or '' }}</textarea>
        <small>رشته‌ی سشن را در مکانی امن نگه دارید و منتشر نکنید.</small>
      </div>
      <div class="col-6">
        <label>کانال‌های مقصد (JSON یا لیست با کاما)</label>
        <textarea name="to_channels" placeholder='["dest1", "dest2"]'>{{ (cfg.to_channels if cfg else '') or '' }}</textarea>
      </div>
    </div>
    <label>کانال‌های منبع (JSON یا لیست با کاما)</label>
    <textarea name="from_channels" placeholder='[1467736193, 2123816390, 1286609636]'>{{ (cfg.from_channels if cfg else '') or '[1467736193, 2123816390, 1286609636]' }}</textarea>
    <label>شناسه کانال‌هایی که R/R نمایش داده نشود</label>
    <input name="skip_rr_channels" placeholder="123456789, -100987654321" value="{{ (cfg.skip_rr_channels if cfg else '') or '' }}">
    <div class="btns">
      <button class="primary" type="submit">ذخیره</button>
    </div>
  </form>
</div>

<div class="card">
  <h2>کنترل ربات</h2>
  <form method="post" action="{{ url_for('start_bot') }}" style="display:inline">
    <button class="primary">Start Bot</button>
  </form>
  <form method="post" action="{{ url_for('stop_bot') }}" style="display:inline">
    <button>Stop Bot</button>
  </form>
  <div style="margin-top:8px;">
    <small>وضعیت: <span id="status">…</span></small>
  </div>
</div>

<script>
async function refreshStatus(){
  try{
    const res = await fetch('/status');
    const j = await res.json();
    document.getElementById('status').innerText = j.running ? 'درحال اجرا ✅' : 'متوقف ⛔';
  }catch(e){
    document.getElementById('status').innerText = 'خطا در خواندن وضعیت';
  }
}
refreshStatus();
setInterval(refreshStatus, 5000);
</script>
{% endblock %}
